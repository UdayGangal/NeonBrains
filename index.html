<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Retro Walkman</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>
  <button id="searchMusicBtn" class="btn search">üîç Search Music</button>

  <div id="searchModal" class="search-modal hidden">
    <input type="text" id="searchInput" placeholder="Search songs..." />
    <button id="searchBtn">Search</button>
    <select id="dropdownList" class="selector"></select>
  </div>

  <div class="main-wrapper">
    <h1 class="title">üé∂ RETRO WALKMAN üé∂</h1>
    <div class="walkman-body">
      <div class="cassette-box">
        <div class="reel reel-left"></div>
        <div class="reel reel-right"></div>
        <div class="tape"></div>
      </div>
      <p id="nowPlaying">üé∂ Now Playing: </p>
      <div class="controls">
        <div class="buttons">
          <button id="playBtn" class="btn play">‚ñ∂Ô∏è ON</button>
          <button id="pauseBtn" class="btn pause">‚è∏Ô∏è Pause</button>
          <button id="stopBtn" class="btn stop">‚èπÔ∏è OFF</button>
        </div>
      </div>
    </div>
  </div>

  <audio id="audioPlayer" src=""></audio>

  <script>
    const searchMusicBtn = document.getElementById("searchMusicBtn");
    const searchModal = document.getElementById("searchModal");
    const searchBtn = document.getElementById("searchBtn");
    const searchInput = document.getElementById("searchInput");
    const dropdownList = document.getElementById("dropdownList");
    const audioPlayer = document.getElementById("audioPlayer");
    const nowPlaying = document.getElementById("nowPlaying");

    searchMusicBtn.addEventListener("click", () => {
      searchModal.classList.toggle("hidden");
      dropdownList.innerHTML = "";
      searchInput.value = "";
    });

    searchBtn.addEventListener("click", async () => {
      const query = searchInput.value.trim();
      if (!query) return;

      const options = {
        method: 'GET',
        headers: {
          'X-RapidAPI-Key': '1eec80a644mshc207367d58b3c29p19977ejsnfb18ffd0d311',
          'X-RapidAPI-Host': 'jiosaavn-api-unofficial.p.rapidapi.com'
        }
      };

      try {
        const response = await fetch(
          `https://jiosaavn-api-unofficial.p.rapidapi.com/search?query=${encodeURIComponent(query)}`,
          options
        );
        const result = await response.json();

        dropdownList.innerHTML = "";

        const songs = result?.data?.songs;

        if (!songs || !Array.isArray(songs) || songs.length === 0) {
          const option = document.createElement("option");
          option.text = "No songs found.";
          dropdownList.appendChild(option);
          return;
        }

        let added = 0;
        songs.forEach(song => {
          const link = song?.downloadUrl?.[4]?.link;
          if (link) {
            const option = document.createElement("option");
            option.value = link;
            option.text = `${song.name} - ${song.primaryArtists}`;
            dropdownList.appendChild(option);
            added++;
          }
        });

        if (added === 0) {
          const option = document.createElement("option");
          option.text = "No playable songs found.";
          dropdownList.appendChild(option);
          return;
        }

        const selected = dropdownList.options[0];
        audioPlayer.src = selected.value;
        audioPlayer.play();
        nowPlaying.innerText = `üé∂ Now Playing: ${selected.text}`;

        dropdownList.onchange = () => {
          const selected = dropdownList.options[dropdownList.selectedIndex];
          audioPlayer.src = selected.value;
          audioPlayer.play();
          nowPlaying.innerText = `üé∂ Now Playing: ${selected.text}`;
        };
      } catch (error) {
        console.error("Failed to fetch songs:", error);
        alert("Error loading songs. Check API key or try again.");
      }
    });
  </script>
</body>
</html>
